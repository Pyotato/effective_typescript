# 🫂 ITEM 60: allowJs로 타입스크립트와 자바스크립트 같이 사용하기

소규모 프로젝트는 한꺼번에 타입스크립트로 전환할 수 있습니다.
그러나 대규모 프로젝트는 한꺼번에 작업하는 것이 불가능하므로 점진적으로 전환할 수 있어야 합니다.
그러려면 마이그레이션 기간 중에 자바스크립트와 타입스크립트가 동시에 동작할수 있도록 해야 합니다.

타입스크립트와 자바스크릡트가 공존하는 방법의 핵심은 `allowJS` 컴파일러 옵션인데, 타입스크립트 파일과 자바스크립트 파일을 서로 임포트할 수 있게 해 줍니다.
자바스크립트 파일은 특별히 건드릴 것이 없습니다.
`@ts-check` ([아이템 59](https://github.com/Pyotato/effective_typescript/blob/item59/README.md)) 지시자를 추가하기 전까지는 문법 오류 이외에 다른 오류가 발생하지 않습니다.
 '**타입스크립트는 자바스크립트의 상위집합이다.**' 라는 명제를 떠올려 보면 쉽게 이해할 수 있습니다.

타입 체크와 관련이 없지만, 기존 빌드 과정에 타입스크립트 컴파일러를 추가하기 위해서 `allowJS` 옵션이 필요합니다.
또한 모듈 단위로 타입스크립트로 전환 ([아이템 61](https://github.com/Pyotato/effective_typescript/blob/item61/README.md))하는 과정에서 테스트를 수행해야 하기 때문에 `allowJS` 옵션이 필요합니다.

번들러에 타입스크립트가 통합되어 있거나, 플러그인 방식으로 통합이 가능하다면  `allowJS`를 간단히 적용할 수 있습니다.
예를 들어 `npm install --save-dev tsify`를 실행하고 `browserify`를 사용하여 플러그인으로 추가해 보겠습니다.

> $ browserify index.ts -p [tsify --allowJS] > bundle.js

대부분의 유닛 테스트 도구에는 동일한 역할을 하는 옵션이 있습니다.
예를 들어, jest를 사용할 때 `ts-jest`를 설치하고 <i>jest.config.js</i>에 전달할 타입스크립트 소스를 지정합니다.

```js
module.exports = {
  transform:{
    '^.+\\.tsx?$': 'ts-jest'.
  }.
};
```

만약, 프레임워크 없이 빌드 체인을 직접 구성했다면 복잡한 작업이 필요할 것입니다.
한 가지 방책으로 outDir 옵션을 사용할 수 있습니다. 
outDir 옵션을 사용하면 타입스크립트가 outDir에 지정된 디렉터리에 소스 디렉터리와 비슷한 구조로 자바스크립트 코드를 생성하게 되고, outDir로 지정된 디렉터리를 대상으로 기존 빌드 체인을 실행하게 됩니다.
참고로 기존 자바스크립트 코드에 특별한 규칙이 있었다면, 타입스크립트가 생성한 코드가 기존 자바스크립트 코드의 규칙을 따르도록 출력 옵션을 조정해야 할 수도 있습니다 (예를 들어 `target`와 `module` 옵션). 

타입스크립트로 마이그레이션하는 동시에 빌드와 테스트가 동작하게 된느 것이 힘들기는 하지만, 제대로 된 점진적 마이그레이션을 시작하기 위해 반드시 필요합니다. 
